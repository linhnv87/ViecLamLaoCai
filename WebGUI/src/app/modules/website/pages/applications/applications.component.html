<!-- Splash Screen -->
<app-splash-screen></app-splash-screen>

<!---->
<div class="container">
  <div class="dashboard-layout">
    <app-dashboard-sidebar></app-dashboard-sidebar>

    <div class="d-flex flex-column gap-3">

      <!-- Header Section -->
      <div class="dashboard-content-wrap">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h2 class="section-title">·ª®ng vi√™n ph·ªèng v·∫•n</h2>
            <p class="section-subtitle">Th·ªùi gian: {{ currentDate }} - {{ interviewCandidates.length }} ·ª©ng vi√™n</p>
          </div>
          <a href="#" class="btn-link">
            <i class="fas fa-arrow-left"></i>
            Danh s√°ch tuy·ªÉn d·ª•ng
          </a>
        </div>
      </div>

      <!-- Filter Section -->
      <div class="dashboard-content-wrap">
        <div class="filter-section">
          <h4 class="filter-title">
            <i class="fas fa-filter"></i>
            L·ªçc ·ª©ng vi√™n
          </h4>
          
          <div class="filter-form">
            <div class="row">
              <div class="col-md-3">
                <div class="form-group">
                  <label>H·ªç t√™n</label>
                  <input type="text" class="form-control" placeholder="Nh·∫≠p h·ªç t√™n ·ª©ng vi√™n" [(ngModel)]="filters.fullName">
                </div>
              </div>
              <div class="col-md-3">
                <div class="form-group">
                  <label>Th√¥ng tin li√™n h·ªá</label>
                  <input type="text" class="form-control" placeholder="Email, s·ªë ƒëi·ªán tho·∫°i" [(ngModel)]="filters.contactInfo">
                </div>
              </div>
              <div class="col-md-2">
                <div class="form-group">
                  <label>Giai ƒëo·∫°n</label>
                  <select class="form-control" [(ngModel)]="filters.stage">
                    <option value="">T·∫•t c·∫£</option>
                    <option value="pending">Ch·ªù ph·ªèng v·∫•n</option>
                    <option value="interviewed">ƒê√£ ph·ªèng v·∫•n</option>
                    <option value="passed">ƒê·∫°t</option>
                    <option value="failed">Kh√¥ng ƒë·∫°t</option>
                  </select>
                </div>
              </div>
              <div class="col-md-2">
                <div class="form-group">
                  <label>Ngu·ªìn ·ª©ng vi√™n</label>
                  <select class="form-control" [(ngModel)]="filters.source">
                    <option value="">T·∫•t c·∫£</option>
                    <option value="website">Website</option>
                    <option value="referral">Gi·ªõi thi·ªáu</option>
                    <option value="jobboard">Job board</option>
                    <option value="social">M·∫°ng x√£ h·ªôi</option>
                  </select>
                </div>
              </div>
              <div class="col-md-2">
                <div class="form-group d-flex align-items-end">
                  <button class="btn btn-primary me-2" (click)="searchCandidates()">
                    <i class="fas fa-search"></i>
                    T√¨m ki·∫øm
                  </button>
                  <button class="btn btn-outline-secondary" (click)="clearFilters()">
                    <i class="fas fa-undo"></i>
                    B·ªè l·ªçc
                  </button>
                </div>
            </div>
            </div>
          </div>
        </div>
            </div>

      <!-- Candidates Table -->
      <div class="dashboard-content-wrap">
        <div class="candidates-table">
          <!-- Table Header -->
          <div class="table-header">
            <div class="table-row header-row">
              <div class="table-cell header-cell">H·ªå V√Ä T√äN</div>
              <div class="table-cell header-cell">TH√îNG TIN LI√äN H·ªÜ</div>
              <div class="table-cell header-cell">GIAI ƒêO·∫†N</div>
              <div class="table-cell header-cell">NGU·ªíN ·ª®NG VI√äN</div>
              <div class="table-cell header-cell">TH·ªúI GIAN</div>
              <div class="table-cell header-cell">H√ÄNH ƒê·ªòNG</div>
            </div>
          </div>

          <!-- Table Body -->
          <div class="table-body">
            <div *ngIf="filteredCandidates.length === 0" class="empty-state">
              <img src="assets/vieclamlaocai/img/icon/icon-docs-empty.svg" alt="">
              <p>Kh√¥ng c√≥ ·ª©ng vi√™n n√†o ph√π h·ª£p v·ªõi b·ªô l·ªçc</p>
            </div>

            <div *ngFor="let candidate of filteredCandidates" class="table-row">
              <div class="table-cell">
                <div class="candidate-info">
                  <img [src]="candidate.avatar" [alt]="candidate.fullName" class="candidate-avatar">
                  <div>
                    <div class="candidate-name">{{ candidate.fullName }}</div>
                    <div class="candidate-position">{{ candidate.position }}</div>
                  </div>
                </div>
              </div>
              <div class="table-cell">
                <div class="contact-info">
                  <div>{{ candidate.email }}</div>
                  <div>{{ candidate.phone }}</div>
                </div>
              </div>
              <div class="table-cell">
                <span class="status-badge" [ngClass]="getStageClass(candidate.stage)">
                  {{ getStageText(candidate.stage) }}
                </span>
              </div>
              <div class="table-cell">
                <span class="source-badge">{{ getSourceText(candidate.source) }}</span>
              </div>
              <div class="table-cell">
                <div class="time-info">
                  <div>{{ candidate.interviewDate }}</div>
                  <div>{{ candidate.interviewTime }}</div>
                </div>
              </div>
              <div class="table-cell">
                <div class="action-menu">
                  <button class="action-trigger" 
                          (click)="toggleActionMenu(candidate.id)"
                          [class.active]="activeMenuId === candidate.id"
                          title="H√†nh ƒë·ªông">
                    <span class="dots">
                      <span class="dot"></span>
                      <span class="dot"></span>
                      <span class="dot"></span>
                    </span>
                  </button>
                  
                  <div class="action-dropdown" 
                       *ngIf="activeMenuId === candidate.id">
                    <div class="dropdown-item" (click)="viewCandidate(candidate)">
                      <span class="icon">üëÅÔ∏è</span>
                      <span>Xem chi ti·∫øt</span>
                    </div>
                    <div class="dropdown-item" (click)="scheduleInterview(candidate)">
                      <span class="icon">üìÖ</span>
                      <span>L√™n l·ªãch ph·ªèng v·∫•n</span>
                    </div>
                    <div class="dropdown-item" (click)="editCandidate(candidate)">
                      <span class="icon">‚úèÔ∏è</span>
                      <span>Ch·ªânh s·ª≠a</span>
                    </div>
                    <div class="dropdown-item" (click)="sendEmail(candidate)">
                      <span class="icon">üìß</span>
                      <span>G·ª≠i email</span>
                    </div>
                    <div class="dropdown-item delete" (click)="deleteCandidate(candidate)">
                      <span class="icon">üóëÔ∏è</span>
                      <span>X√≥a</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
            </div>
          </div>

    </div>
  </div>
            </div>

<!-- View Candidate Modal -->
<div class="modal fade" id="viewCandidateModal" tabindex="-1" aria-labelledby="viewCandidateModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="viewCandidateModalLabel">Chi ti·∫øt ·ª©ng vi√™n</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" *ngIf="selectedCandidate">
        <div class="row">
          <div class="col-md-4 text-center">
            <img [src]="selectedCandidate.avatar" [alt]="selectedCandidate.fullName" class="candidate-avatar-large mb-3">
            <h4>{{ selectedCandidate.fullName }}</h4>
            <p class="text-muted">{{ selectedCandidate.position }}</p>
          </div>
          <div class="col-md-8">
            <div class="candidate-details">
              <div class="detail-item">
                <label><strong>Email:</strong></label>
                <span>{{ selectedCandidate.email }}</span>
              </div>
              <div class="detail-item">
                <label><strong>S·ªë ƒëi·ªán tho·∫°i:</strong></label>
                <span>{{ selectedCandidate.phone }}</span>
              </div>
              <div class="detail-item">
                <label><strong>Giai ƒëo·∫°n:</strong></label>
                <span class="status-badge" [ngClass]="getStageClass(selectedCandidate.stage)">
                  {{ getStageText(selectedCandidate.stage) }}
                </span>
              </div>
              <div class="detail-item">
                <label><strong>Ngu·ªìn:</strong></label>
                <span>{{ getSourceText(selectedCandidate.source) }}</span>
              </div>
              <div class="detail-item">
                <label><strong>Ng√†y ph·ªèng v·∫•n:</strong></label>
                <span>{{ selectedCandidate.interviewDate }}</span>
              </div>
              <div class="detail-item">
                <label><strong>Gi·ªù ph·ªèng v·∫•n:</strong></label>
                <span>{{ selectedCandidate.interviewTime }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ƒê√≥ng</button>
        <button type="button" class="btn btn-primary" (click)="editCandidate(selectedCandidate!)" *ngIf="selectedCandidate">Ch·ªânh s·ª≠a</button>
      </div>
    </div>
  </div>
            </div>

<!-- Schedule Interview Modal -->
<div class="modal fade" id="scheduleInterviewModal" tabindex="-1" aria-labelledby="scheduleInterviewModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="scheduleInterviewModalLabel">L√™n l·ªãch ph·ªèng v·∫•n</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
      <div class="modal-body" *ngIf="selectedCandidate">
        <form>
          <div class="mb-3">
            <label class="form-label">·ª®ng vi√™n</label>
            <input type="text" class="form-control" [value]="selectedCandidate.fullName" readonly>
          </div>
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label">Ng√†y ph·ªèng v·∫•n *</label>
                <input type="date" class="form-control" [(ngModel)]="interviewData.date" name="date" required>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label">Gi·ªù ph·ªèng v·∫•n *</label>
                <input type="time" class="form-control" [(ngModel)]="interviewData.time" name="time" required>
              </div>
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label">ƒê·ªãa ƒëi·ªÉm</label>
            <input type="text" class="form-control" [(ngModel)]="interviewData.location" name="location" placeholder="Nh·∫≠p ƒë·ªãa ƒëi·ªÉm ph·ªèng v·∫•n">
          </div>
          <div class="mb-3">
            <label class="form-label">Ghi ch√∫</label>
            <textarea class="form-control" rows="3" [(ngModel)]="interviewData.notes" name="notes" placeholder="Ghi ch√∫ v·ªÅ bu·ªïi ph·ªèng v·∫•n"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
        <button type="button" class="btn btn-success" (click)="saveInterviewSchedule()">L∆∞u l·ªãch</button>
      </div>
    </div>
  </div>
                </div>

<!-- Edit Candidate Modal -->
<div class="modal fade" id="editCandidateModal" tabindex="-1" aria-labelledby="editCandidateModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editCandidateModalLabel">Ch·ªânh s·ª≠a th√¥ng tin ·ª©ng vi√™n</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
      <div class="modal-body" *ngIf="selectedCandidate">
        <form>
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label">H·ªç v√† t√™n *</label>
                <input type="text" class="form-control" [(ngModel)]="editData.fullName" name="fullName" required>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label">V·ªã tr√≠ ·ª©ng tuy·ªÉn *</label>
                <input type="text" class="form-control" [(ngModel)]="editData.position" name="position" required>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label">Email *</label>
                <input type="email" class="form-control" [(ngModel)]="editData.email" name="email" required>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label">S·ªë ƒëi·ªán tho·∫°i *</label>
                <input type="tel" class="form-control" [(ngModel)]="editData.phone" name="phone" required>
        </div>
          </div>
          </div>
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label">Giai ƒëo·∫°n</label>
                <select class="form-control" [(ngModel)]="editData.stage" name="stage">
                  <option value="pending">Ch·ªù ph·ªèng v·∫•n</option>
                  <option value="interviewed">ƒê√£ ph·ªèng v·∫•n</option>
                  <option value="passed">ƒê·∫°t</option>
                  <option value="failed">Kh√¥ng ƒë·∫°t</option>
                </select>
                </div>
                </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label">Ngu·ªìn ·ª©ng vi√™n</label>
                <select class="form-control" [(ngModel)]="editData.source" name="source">
                  <option value="website">Website</option>
                  <option value="referral">Gi·ªõi thi·ªáu</option>
                  <option value="jobboard">Job board</option>
                  <option value="social">M·∫°ng x√£ h·ªôi</option>
                </select>
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
        <button type="button" class="btn btn-warning" (click)="saveCandidateEdit()">L∆∞u thay ƒë·ªïi</button>
      </div>
    </div>
  </div>
</div>

<!-- Send Email Modal -->
<div class="modal fade" id="sendEmailModal" tabindex="-1" aria-labelledby="sendEmailModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="sendEmailModalLabel">G·ª≠i email</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" *ngIf="selectedCandidate">
        <form>
          <div class="mb-3">
            <label class="form-label">ƒê·∫øn</label>
            <input type="email" class="form-control" [value]="selectedCandidate.email" readonly>
          </div>
          <div class="mb-3">
            <label class="form-label">Ti√™u ƒë·ªÅ *</label>
            <input type="text" class="form-control" [(ngModel)]="emailData.subject" name="subject" required placeholder="Nh·∫≠p ti√™u ƒë·ªÅ email">
          </div>
          <div class="mb-3">
            <label class="form-label">N·ªôi dung *</label>
            <textarea class="form-control" rows="6" [(ngModel)]="emailData.content" name="content" required placeholder="Nh·∫≠p n·ªôi dung email"></textarea>
          </div>
          <div class="mb-3">
            <label class="form-label">Template email</label>
            <select class="form-control" [(ngModel)]="emailData.template" name="template" (change)="loadEmailTemplate()">
              <option value="">Ch·ªçn template</option>
              <option value="interview_invitation">M·ªùi ph·ªèng v·∫•n</option>
              <option value="interview_confirmation">X√°c nh·∫≠n l·ªãch ph·ªèng v·∫•n</option>
              <option value="rejection">Th√¥ng b√°o kh√¥ng ƒë·∫°t</option>
              <option value="offer">Th∆∞ m·ªùi nh·∫≠n vi·ªác</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
        <button type="button" class="btn btn-info" (click)="previewEmail()">Xem tr∆∞·ªõc</button>
        <button type="button" class="btn btn-primary" (click)="sendEmailData()">G·ª≠i email</button>
      </div>
              </div>
            </div>
          </div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteCandidateModal" tabindex="-1" aria-labelledby="deleteCandidateModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteCandidateModalLabel">X√°c nh·∫≠n x√≥a</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" *ngIf="selectedCandidate">
        <div class="text-center">
          <i class="fas fa-exclamation-triangle text-warning" style="font-size: 3rem;"></i>
          <h5 class="mt-3">B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a?</h5>
          <p class="text-muted">
            ·ª®ng vi√™n <strong>{{ selectedCandidate.fullName }}</strong> s·∫Ω b·ªã x√≥a vƒ©nh vi·ªÖn kh·ªèi h·ªá th·ªëng.
          </p>
          <p class="text-danger"><small>H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c!</small></p>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
        <button type="button" class="btn btn-danger" (click)="confirmDeleteCandidate()">X√≥a vƒ©nh vi·ªÖn</button>
      </div>
    </div>
  </div>
</div>