<!-- Business Verification Modal -->
<div class="email-verification-modal" *ngIf="isOpen">
  <div class="modal-overlay" (click)="closeModal()"></div>
  
  <div class="modal-content">
    <div class="modal-header">
      <h3 class="modal-title">X√°c th·ª±c th√¥ng tin doanh nghi·ªáp</h3>
      <button class="close-btn" (click)="closeModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <div class="modal-body">
      <div class="verification-steps">
        <div class="step active">
          <div class="step-number">1</div>
          <div class="step-text">Th√¥ng tin c∆° b·∫£n</div>
        </div>
        <div class="step" [class.active]="currentStep >= 2">
          <div class="step-number">2</div>
          <div class="step-text">Gi·∫•y t·ªù ph√°p l√Ω</div>
        </div>
        <div class="step" [class.active]="currentStep >= 3">
          <div class="step-number">3</div>
          <div class="step-text">X√°c nh·∫≠n</div>
        </div>
      </div>

      <!-- Step 1: Basic Information -->
      <div class="step-content" *ngIf="currentStep === 1">
        <h4>Th√¥ng tin doanh nghi·ªáp</h4>
        <p class="text-muted">
          <span *ngIf="companyInfo?.companyName">‚úÖ Th√¥ng tin c√≥ s·∫µn ƒë√£ ƒë∆∞·ª£c t·∫£i. B·∫°n c√≥ th·ªÉ c·∫≠p nh·∫≠t ho·∫∑c b·ªï sung th√™m.</span>
          <span *ngIf="!companyInfo?.companyName">üìù Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin doanh nghi·ªáp ƒë·ªÉ x√°c th·ª±c.</span>
        </p>

        <!-- Loading indicator -->
        <div *ngIf="isLoadingCompanyInfo" class="loading-indicator">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">ƒêang t·∫£i...</span>
          </div>
          <span class="ms-2">ƒêang t·∫£i th√¥ng tin doanh nghi·ªáp...</span>
        </div>

        <form [formGroup]="basicInfoForm" class="verification-form">
          <div class="form-row">
            <div class="form-group">
              <label class="form-label required">T√™n doanh nghi·ªáp</label>
              <input type="text" class="form-control" formControlName="companyName" placeholder="Nh·∫≠p t√™n doanh nghi·ªáp">
              <div class="error-message" *ngIf="basicInfoForm.get('companyName')?.invalid && basicInfoForm.get('companyName')?.touched">
                T√™n doanh nghi·ªáp l√† b·∫Øt bu·ªôc
              </div>
            </div>

            <div class="form-group">
              <label class="form-label required">M√£ s·ªë thu·∫ø</label>
              <input type="text" class="form-control" formControlName="taxNumber" placeholder="Nh·∫≠p m√£ s·ªë thu·∫ø">
              <div class="error-message" *ngIf="basicInfoForm.get('taxNumber')?.invalid && basicInfoForm.get('taxNumber')?.touched">
                M√£ s·ªë thu·∫ø l√† b·∫Øt bu·ªôc
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Ng∆∞·ªùi ƒë·∫°i di·ªán</label>
              <input type="text" class="form-control" [value]="companyInfo?.representativeName || ''" readonly placeholder="T√™n ng∆∞·ªùi ƒë·∫°i di·ªán s·∫Ω ƒë∆∞·ª£c l·∫•y t·ª´ th√¥ng tin t√†i kho·∫£n">
              <small class="form-text text-muted">Th√¥ng tin n√†y ƒë∆∞·ª£c l·∫•y t·ª´ t√†i kho·∫£n c·ªßa b·∫°n</small>
            </div>

            <div class="form-group">
              <label class="form-label required">Ch·ª©c v·ª•</label>
              <input type="text" class="form-control" formControlName="position" placeholder="Gi√°m ƒë·ªëc, Ch·ªß t·ªãch...">
              <div class="error-message" *ngIf="basicInfoForm.get('position')?.invalid && basicInfoForm.get('position')?.touched">
                Ch·ª©c v·ª• l√† b·∫Øt bu·ªôc
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label required">S·ªë ƒëi·ªán tho·∫°i</label>
              <input type="tel" class="form-control" formControlName="phone" placeholder="S·ªë ƒëi·ªán tho·∫°i li√™n h·ªá">
              <div class="error-message" *ngIf="basicInfoForm.get('phone')?.invalid && basicInfoForm.get('phone')?.touched">
                S·ªë ƒëi·ªán tho·∫°i kh√¥ng h·ª£p l·ªá
              </div>
            </div>

            <div class="form-group">
              <label class="form-label required">Email</label>
              <input type="email" class="form-control" formControlName="email" placeholder="Email doanh nghi·ªáp">
              <div class="error-message" *ngIf="basicInfoForm.get('email')?.invalid && basicInfoForm.get('email')?.touched">
                Email kh√¥ng h·ª£p l·ªá
              </div>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label required">ƒê·ªãa ch·ªâ tr·ª• s·ªü</label>
            <textarea class="form-control" formControlName="address" rows="3" placeholder="ƒê·ªãa ch·ªâ ƒë·∫ßy ƒë·ªß c·ªßa tr·ª• s·ªü ch√≠nh"></textarea>
            <div class="error-message" *ngIf="basicInfoForm.get('address')?.invalid && basicInfoForm.get('address')?.touched">
              ƒê·ªãa ch·ªâ l√† b·∫Øt bu·ªôc
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Website</label>
              <input type="url" class="form-control" formControlName="website" placeholder="https://example.com">
            </div>

            <div class="form-group">
              <label class="form-label">Quy m√¥ c√¥ng ty</label>
              <select class="form-control" formControlName="companySize">
                <option value="">Ch·ªçn quy m√¥</option>
                <option value="1-10">1-10 nh√¢n vi√™n</option>
                <option value="11-50">11-50 nh√¢n vi√™n</option>
                <option value="51-200">51-200 nh√¢n vi√™n</option>
                <option value="201-500">201-500 nh√¢n vi√™n</option>
                <option value="500+">Tr√™n 500 nh√¢n vi√™n</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">M√¥ t·∫£ doanh nghi·ªáp</label>
            <textarea class="form-control" formControlName="description" rows="4" placeholder="Gi·ªõi thi·ªáu v·ªÅ doanh nghi·ªáp, lƒ©nh v·ª±c ho·∫°t ƒë·ªông..."></textarea>
          </div>
        </form>
      </div>

      <!-- Step 2: Legal Documents -->
      <div class="step-content" *ngIf="currentStep === 2">
        <h4>Gi·∫•y t·ªù ph√°p l√Ω</h4>
        <p class="text-muted">Vui l√≤ng upload c√°c gi·∫•y t·ªù c·∫ßn thi·∫øt ƒë·ªÉ x√°c minh doanh nghi·ªáp</p>

        <div class="document-upload-section">
          <div class="document-item">
            <div class="document-header">
              <div class="document-icon">
                <i class="fas fa-file-contract"></i>
              </div>
              <div class="document-info">
                <h5>Gi·∫•y ph√©p kinh doanh</h5>
                <p>Gi·∫•y ph√©p ƒëƒÉng k√Ω kinh doanh ho·∫∑c Gi·∫•y ch·ª©ng nh·∫≠n ƒëƒÉng k√Ω doanh nghi·ªáp</p>
              </div>
            </div>
            <!-- Upload area - only show when no file -->
            <div class="upload-area" (click)="triggerFileUpload('businessLicense')" *ngIf="!documents.businessLicense">
              <input type="file" #businessLicenseInput (change)="onFileSelected($event, 'businessLicense')" accept=".pdf,.jpg,.jpeg,.png" style="display: none;">
              <div class="upload-content">
                <i class="fas fa-cloud-upload-alt"></i>
                <p>Click ƒë·ªÉ ch·ªçn file ho·∫∑c k√©o th·∫£ v√†o ƒë√¢y</p>
                <span class="file-types">PDF, JPG, PNG (T·ªëi ƒëa 5MB)</span>
              </div>
            </div>

            <!-- File preview - only show when file exists -->
            <div class="file-preview-container" *ngIf="documents.businessLicense">
              <div class="file-preview">
                <div class="file-info">
                  <i class="fas fa-file-pdf"></i>
                  <span class="file-name">{{documents.businessLicense.name}}</span>
                  <span class="file-size">({{getFileSize(documents.businessLicense.size)}})</span>
                </div>
                <div class="file-actions">
                  <button class="btn-replace" (click)="triggerFileUpload('businessLicense', $event)" title="Thay th·∫ø file">
                    <i class="fas fa-sync-alt"></i> Thay th·∫ø
                  </button>
                  <button class="remove-file" (click)="removeFile('businessLicense', $event)" title="X√≥a file">
                    <i class="fas fa-times"></i> X√≥a
                  </button>
                </div>
              </div>
            </div>
          </div>

          <div class="document-item">
            <div class="document-header">
              <div class="document-icon">
                <i class="fas fa-id-card"></i>
              </div>
              <div class="document-info">
                <h5>CMND/CCCD ng∆∞·ªùi ƒë·∫°i di·ªán</h5>
                <p>Ch·ª©ng minh nh√¢n d√¢n ho·∫∑c CƒÉn c∆∞·ªõc c√¥ng d√¢n c·ªßa ng∆∞·ªùi ƒë·∫°i di·ªán</p>
              </div>
            </div>
            <!-- Upload area - only show when no file -->
            <div class="upload-area" (click)="triggerFileUpload('representativeId')" *ngIf="!documents.representativeId">
              <input type="file" #representativeIdInput (change)="onFileSelected($event, 'representativeId')" accept=".pdf,.jpg,.jpeg,.png" style="display: none;">
              <div class="upload-content">
                <i class="fas fa-cloud-upload-alt"></i>
                <p>Click ƒë·ªÉ ch·ªçn file ho·∫∑c k√©o th·∫£ v√†o ƒë√¢y</p>
                <span class="file-types">PDF, JPG, PNG (T·ªëi ƒëa 5MB)</span>
              </div>
            </div>

            <!-- File preview - only show when file exists -->
            <div class="file-preview-container" *ngIf="documents.representativeId">
              <div class="file-preview">
                <div class="file-info">
                  <i class="fas fa-file-pdf"></i>
                  <span class="file-name">{{documents.representativeId.name}}</span>
                  <span class="file-size">({{getFileSize(documents.representativeId.size)}})</span>
                </div>
                <div class="file-actions">
                  <button class="btn-replace" (click)="triggerFileUpload('representativeId', $event)" title="Thay th·∫ø file">
                    <i class="fas fa-sync-alt"></i> Thay th·∫ø
                  </button>
                  <button class="remove-file" (click)="removeFile('representativeId', $event)" title="X√≥a file">
                    <i class="fas fa-times"></i> X√≥a
                  </button>
                </div>
              </div>
            </div>
          </div>

          <div class="document-item">
            <div class="document-header">
              <div class="document-icon">
                <i class="fas fa-stamp"></i>
              </div>
              <div class="document-info">
                <h5>Con d·∫•u c√¥ng ty</h5>
                <p>·∫¢nh con d·∫•u c·ªßa c√¥ng ty (n·∫øu c√≥)</p>
              </div>
            </div>
            <!-- Upload area - only show when no file -->
            <div class="upload-area" (click)="triggerFileUpload('companyStamp')" *ngIf="!documents.companyStamp">
              <input type="file" #companyStampInput (change)="onFileSelected($event, 'companyStamp')" accept=".jpg,.jpeg,.png" style="display: none;">
              <div class="upload-content">
                <i class="fas fa-cloud-upload-alt"></i>
                <p>Click ƒë·ªÉ ch·ªçn file ho·∫∑c k√©o th·∫£ v√†o ƒë√¢y</p>
                <span class="file-types">JPG, PNG (T·ªëi ƒëa 5MB)</span>
              </div>
            </div>

            <!-- File preview - only show when file exists -->
            <div class="file-preview-container" *ngIf="documents.companyStamp">
              <div class="file-preview">
                <div class="file-info">
                  <i class="fas fa-file-image"></i>
                  <span class="file-name">{{documents.companyStamp.name}}</span>
                  <span class="file-size">({{getFileSize(documents.companyStamp.size)}})</span>
                </div>
                <div class="file-actions">
                  <button class="btn-replace" (click)="triggerFileUpload('companyStamp', $event)" title="Thay th·∫ø file">
                    <i class="fas fa-sync-alt"></i> Thay th·∫ø
                  </button>
                  <button class="remove-file" (click)="removeFile('companyStamp', $event)" title="X√≥a file">
                    <i class="fas fa-times"></i> X√≥a
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="verification-note">
          <div class="note-icon">
            <i class="fas fa-info-circle"></i>
          </div>
          <div class="note-content">
            <h6>L∆∞u √Ω quan tr·ªçng:</h6>
            <ul>
              <li>T·∫•t c·∫£ gi·∫•y t·ªù ph·∫£i r√µ r√†ng, kh√¥ng b·ªã m·ªù ho·∫∑c che khu·∫•t</li>
              <li>File PDF ho·∫∑c ·∫£nh c√≥ k√≠ch th∆∞·ªõc t·ªëi ƒëa 5MB</li>
              <li>Th√¥ng tin tr√™n gi·∫•y t·ªù ph·∫£i kh·ªõp v·ªõi th√¥ng tin ƒë√£ ƒëƒÉng k√Ω</li>
              <li>Qu√° tr√¨nh x√°c minh c√≥ th·ªÉ m·∫•t 3-5 ng√†y l√†m vi·ªác</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Step 3: Confirmation -->
      <div class="step-content" *ngIf="currentStep === 3">
        <h4>X√°c nh·∫≠n th√¥ng tin</h4>
        <p class="text-muted">Vui l√≤ng ki·ªÉm tra l·∫°i th√¥ng tin tr∆∞·ªõc khi g·ª≠i</p>

        <div class="confirmation-summary">
          <div class="summary-section">
            <h5>Th√¥ng tin doanh nghi·ªáp</h5>
            <div class="summary-item">
              <span class="label">T√™n doanh nghi·ªáp:</span>
              <span class="value">{{basicInfoForm.value.companyName}}</span>
            </div>
            <div class="summary-item">
              <span class="label">M√£ s·ªë thu·∫ø:</span>
              <span class="value">{{basicInfoForm.value.taxNumber}}</span>
            </div>
            <div class="summary-item">
              <span class="label">Ng∆∞·ªùi ƒë·∫°i di·ªán:</span>
              <span class="value">{{companyInfo?.representativeName || 'Ch∆∞a c√≥ th√¥ng tin'}} - {{basicInfoForm.value.position}}</span>
            </div>
            <div class="summary-item">
              <span class="label">ƒê·ªãa ch·ªâ:</span>
              <span class="value">{{basicInfoForm.value.address}}</span>
            </div>
          </div>

          <div class="summary-section">
            <h5>Gi·∫•y t·ªù ƒë√£ upload</h5>
            <div class="summary-item" *ngIf="documents.businessLicense">
              <span class="label">Gi·∫•y ph√©p kinh doanh:</span>
              <span class="value">{{documents.businessLicense.name}}</span>
            </div>
            <div class="summary-item" *ngIf="documents.representativeId">
              <span class="label">CMND/CCCD:</span>
              <span class="value">{{documents.representativeId.name}}</span>
            </div>
            <div class="summary-item" *ngIf="documents.companyStamp">
              <span class="label">Con d·∫•u c√¥ng ty:</span>
              <span class="value">{{documents.companyStamp.name}}</span>
            </div>
          </div>
        </div>

                 <div class="terms-checkbox">
           <label class="checkbox-container">
             <input type="checkbox" [ngModel]="agreeToTerms" (ngModelChange)="agreeToTerms = $event">
             <span class="checkmark"></span>
             T√¥i cam k·∫øt r·∫±ng t·∫•t c·∫£ th√¥ng tin v√† gi·∫•y t·ªù cung c·∫•p l√† ch√≠nh x√°c v√† h·ª£p ph√°p
           </label>
         </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="previousStep()" *ngIf="currentStep > 1">
        <i class="fas fa-arrow-left"></i> Quay l·∫°i
      </button>
      
      <button class="btn btn-primary" (click)="nextStep()" *ngIf="currentStep < 3" [disabled]="!canProceed()">
        Ti·∫øp t·ª•c <i class="fas fa-arrow-right"></i>
      </button>
      
      <button class="btn btn-success" (click)="submitVerification()" *ngIf="currentStep === 3" [disabled]="!canSubmit()">
        <i class="fas fa-paper-plane"></i> G·ª≠i x√°c th·ª±c
      </button>
    </div>
  </div>
</div>

