<!-- Splash Screen -->
<app-splash-screen></app-splash-screen>

<!---->
<div class="container">
  <div class="dashboard-layout">
    <app-dashboard-sidebar></app-dashboard-sidebar>

    <div class="dashboard-content-wrap">
       <!-- Doanh Nghiep Role - Business verification banner -->
        <div *ngIf="isDoanhNghiep() && verificationStatus !== 'approved'" class="dashboard-content-wrap">
          <div class="mail-box" [ngClass]="{
            'verification-pending': verificationStatus === 'pending',
            'verification-none': verificationStatus === 'none'
          }">
            <div class="banner">
              <img src="assets/vieclamlaocai/img/Illustrationa.png" alt="">
            </div>
            <div class="info">
              <div class="title">
                <span *ngIf="verificationStatus === 'none'">X√°c th·ª±c th√¥ng tin doanh nghi·ªáp</span>
                <span *ngIf="verificationStatus === 'pending'">ƒêang ch·ªù x√°c th·ª±c</span>
              </div>
              <div class="description">
                <span *ngIf="verificationStatus === 'none'">Ho√†n t·∫•t h·ªì s∆° v√† upload gi·∫•y t·ªù ƒë·ªÉ ƒë∆∞·ª£c ph√™ duy·ªát t·ª´ c∆° quan qu·∫£n l√Ω</span>
                <span *ngIf="verificationStatus === 'pending'">Y√™u c·∫ßu x√°c th·ª±c c·ªßa b·∫°n ƒëang ƒë∆∞·ª£c xem x√©t. Vui l√≤ng ch·ªù ph√™ duy·ªát t·ª´ c∆° quan qu·∫£n l√Ω</span>
              </div>
              <div class="btn2-wrap large orange w-100" (click)="openEmailVerification()" *ngIf="verificationStatus === 'none'">
                X√°c th·ª±c ngay
              </div>
              <div class="btn2-wrap large gray w-100" *ngIf="verificationStatus === 'pending'">
                <i class="fas fa-clock"></i> ƒêang x·ª≠ l√Ω...
              </div>
            </div>
          </div>
        </div>
      <div class="statistic-list">

        <!-- Doanh Nghiep Role - 4 statistics -->
        <div class="statistic-wrap" *ngIf="isDoanhNghiep()">
          <div class="img-wrap purple">
            <img src="assets/vieclamlaocai/img/icon/icon-user-view.svg" alt="">
          </div>

          <div class="d-flex flex-column justify-content-center gap-1">
            <div class="number">{{doanhNghiepStats.totalProfileViews}}</div>
            <div class="title">L∆∞·ª£t xem h·ªì s∆°</div>
          </div>
        </div>

        <div class="statistic-wrap" *ngIf="isDoanhNghiep()">
          <div class="img-wrap yellow">
            <img src="assets/vieclamlaocai/img/icon/icon-color-bag.svg" alt="">
          </div>

          <div class="d-flex flex-column justify-content-center gap-1">
            <div class="number">{{doanhNghiepStats.totalJobs}}</div>
            <div class="title">Vi·ªác l√†m ƒë√£ ƒëƒÉng</div>
          </div>
        </div>

        <div class="statistic-wrap" *ngIf="isDoanhNghiep()">
          <div class="img-wrap cyan">
            <img src="assets/vieclamlaocai/img/icon/icon-doc-user.svg" alt="">
          </div>

          <div class="d-flex flex-column justify-content-center gap-1">
            <div class="number">{{doanhNghiepStats.totalApplications}}</div>
            <div class="title">H·ªì s∆° ·ª©ng tuy·ªÉn</div>
          </div>
        </div>

        <div class="statistic-wrap" *ngIf="isDoanhNghiep()">
          <div class="img-wrap sky">
            <img src="assets/vieclamlaocai/img/icon/icon-docs.svg" alt="">
          </div>

          <div class="d-flex flex-column justify-content-center gap-1">
            <div class="number">{{doanhNghiepStats.todayApplications}}</div>
            <div class="title">H·ªì s∆° ·ª©ng tuy·ªÉn h√¥m nay</div>
          </div>
        </div>

        <!-- Ung Vien Role - 4 statistics -->
        <div class="statistic-wrap" *ngIf="isUngVien()">
          <div class="img-wrap yellow">
            <img src="assets/vieclamlaocai/img/icon/icon-color-bag.svg" alt="">
          </div>

          <div class="d-flex flex-column justify-content-center gap-1">
            <div class="number">{{ungVienStats.suitableJobs}}</div>
            <div class="title">Vi·ªác l√†m ph√π h·ª£p</div>
          </div>
        </div>

        <div class="statistic-wrap" *ngIf="isUngVien()">
          <div class="img-wrap purple">
            <img src="assets/vieclamlaocai/img/icon/icon-user-view.svg" alt="">
          </div>

          <div class="d-flex flex-column justify-content-center gap-1">
            <div class="number">{{ungVienStats.profileViews}}</div>
            <div class="title">L∆∞·ª£t xem h·ªì s∆°</div>
          </div>
        </div>

        <div class="statistic-wrap" *ngIf="isUngVien()">
          <div class="img-wrap cyan">
            <img src="assets/vieclamlaocai/img/icon/icon-doc-user.svg" alt="">
          </div>

          <div class="d-flex flex-column justify-content-center gap-1">
            <div class="number">{{ungVienStats.employerEmails}}</div>
            <div class="title">NTD g·ª≠i email m·ªùi ·ª©ng tuy·ªÉn</div>
          </div>
        </div>

        <div class="statistic-wrap" *ngIf="isUngVien()">
          <div class="img-wrap sky">
            <img src="assets/vieclamlaocai/img/icon/icon-docs.svg" alt="">
          </div>

          <div class="d-flex flex-column justify-content-center gap-1">
            <div class="number">{{ungVienStats.totalCVs}}</div>
            <div class="title">T·ªïng CV ƒëang c√≥</div>
          </div>
        </div>

        <!-- Co Quan Quan Ly Role - 4 statistics -->
        <div class="statistic-wrap" *ngIf="isCoQuanQuanLy()">
          <div class="img-wrap orange">
            <img src="assets/vieclamlaocai/img/icon/icon-doc-user.svg" alt="">
          </div>

          <div class="d-flex flex-column justify-content-center gap-1">
            <div class="number">{{coQuanQuanLyStats.pendingApprovals}}</div>
            <div class="title">Ch·ªù ph√™ duy·ªát</div>
          </div>
        </div>

        <div class="statistic-wrap" *ngIf="isCoQuanQuanLy()">
          <div class="img-wrap green">
            <img src="assets/vieclamlaocai/img/icon/icon-color-bag.svg" alt="">
          </div>

          <div class="d-flex flex-column justify-content-center gap-1">
            <div class="number">{{coQuanQuanLyStats.approvedBusinesses}}</div>
            <div class="title">ƒê√£ ph√™ duy·ªát</div>
          </div>
        </div>

        <div class="statistic-wrap" *ngIf="isCoQuanQuanLy()">
          <div class="img-wrap red">
            <img src="assets/vieclamlaocai/img/icon/icon-docs.svg" alt="">
          </div>

          <div class="d-flex flex-column justify-content-center gap-1">
            <div class="number">{{coQuanQuanLyStats.rejectedBusinesses}}</div>
            <div class="title">T·ª´ ch·ªëi</div>
          </div>
        </div>

        <div class="statistic-wrap" *ngIf="isCoQuanQuanLy()">
          <div class="img-wrap blue">
            <img src="assets/vieclamlaocai/img/icon/icon-user-view.svg" alt="">
          </div>

          <div class="d-flex flex-column justify-content-center gap-1">
            <div class="number">{{coQuanQuanLyStats.totalBusinesses}}</div>
            <div class="title">T·ªïng doanh nghi·ªáp</div>
          </div>
        </div>

      </div>

      <div class="section-data">
        <div class="section-data-title">{{getSectionTitle()}}</div>

        <!-- Doanh Nghiep Role - Danh s√°ch ·ª©ng vi√™n ph√π h·ª£p -->
        <div *ngIf="isDoanhNghiep() && hasRecentCandidates">
          <div class="user-data-wrap" *ngFor="let candidate of recentCandidatesData">
            <div class="user-data-user">
              <img [src]="candidate.avatar" alt="" class="avatar">
              <a href="#" class="name">{{candidate.name}}</a>
              <div class="experiment tag-wrap orange">{{candidate.experience}}</div>
              <div class="tag">
                <span>{{candidate.position}}</span>
                <span class="dot"></span>
                <span>{{candidate.age}} tu·ªïi</span>
              </div>
            </div>

            <div class="user-data-info">
              <div class="info-row">
                <div class="d-flex gap-3 align-items-center">
                  <img src="assets/vieclamlaocai/img/icon/icon-pin.svg" alt="">
                  <span>ƒê·ªãa ƒëi·ªÉm</span>
                </div>
                <div>{{candidate.location}}</div>
              </div>

              <div class="info-row">
                <div class="d-flex gap-3 align-items-center">
                  <img src="assets/vieclamlaocai/img/icon/icon-pin.svg" alt="">
                  <span>C·∫•p b·∫≠c</span>
                </div>
                <div>{{candidate.level}}</div>
              </div>

              <div class="info-row">
                <div class="d-flex gap-3 align-items-center">
                  <img src="assets/vieclamlaocai/img/icon/icon-pin.svg" alt="">
                  <span>Ng√†nh ngh·ªÅ</span>
                </div>
                <div>{{candidate.industry}}</div>
              </div>

              <div class="info-row">
                <div class="d-flex gap-3 align-items-center">
                  <img src="assets/vieclamlaocai/img/icon/icon-pin.svg" alt="">
                  <span>Kinh nghi·ªám</span>
                </div>
                <div>{{candidate.previousCompany}}</div>
              </div>

              <div class="info-row">
                <div class="d-flex gap-3 align-items-center">
                  <img src="assets/vieclamlaocai/img/icon/icon-pin.svg" alt="">
                  <span>B·∫±ng c·∫•p</span>
                </div>
                <div>{{candidate.education}}</div>
              </div>

              <div class="d-flex justify-content-end mt-3">
                <div class="tag-wrap px-5">{{candidate.salaryExpectation}}</div>
              </div>
            </div>
          </div>
        </div>

       

        <!-- Doanh Nghiep Role - No data fallback -->
        <div *ngIf="isDoanhNghiep() && !hasRecentCandidates && isEmailVerified" class="text-center py-4">
          <div class="text-muted">
            <i class="fas fa-info-circle"></i>
            <p>Ch∆∞a c√≥ ·ª©ng vi√™n ph√π h·ª£p n√†o</p>
          </div>
        </div>

        <!-- Ung Vien Role - Vi·ªác l√†m ƒë√£ l∆∞u g·∫ßn ƒë√¢y -->
        <div *ngIf="isUngVien() && hasSavedJobs">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <div class="section-data-title">Vi·ªác l√†m ƒë√£ l∆∞u g·∫ßn ƒë√¢y</div>
            <a href="#" class="btn btn-outline-primary btn-sm">Xem t·∫•t c·∫£</a>
          </div>
          <div class="user-data-wrap" *ngFor="let savedJob of savedJobsData">
            <div class="user-data-user">
              <img [src]="savedJob.logo" alt="" class="avatar">
              <a href="#" class="name">{{savedJob.jobTitle}}</a>
              <div class="experiment tag-wrap orange">{{savedJob.company}}</div>
              <div class="tag">
                <span>{{savedJob.location}}</span>
                <span class="dot"></span>
                <span>{{savedJob.salary}}</span>
              </div>
            </div>

            <div class="user-data-info">
              <div class="info-row">
                <div class="d-flex gap-3 align-items-center">
                  <img src="assets/vieclamlaocai/img/icon/icon-pin.svg" alt="">
                  <span>C√¥ng ty</span>
                </div>
                <div>{{savedJob.company}}</div>
              </div>

              <div class="info-row">
                <div class="d-flex gap-3 align-items-center">
                  <img src="assets/vieclamlaocai/img/icon/icon-pin.svg" alt="">
                  <span>ƒê·ªãa ƒëi·ªÉm</span>
                </div>
                <div>{{savedJob.location}}</div>
              </div>

              <div class="info-row">
                <div class="d-flex gap-3 align-items-center">
                  <img src="assets/vieclamlaocai/img/icon/icon-pin.svg" alt="">
                  <span>M·ª©c l∆∞∆°ng</span>
                </div>
                <div>{{savedJob.salary}}</div>
              </div>

              <div class="info-row">
                <div class="d-flex gap-3 align-items-center">
                  <img src="assets/vieclamlaocai/img/icon/icon-pin.svg" alt="">
                  <span>Ng√†y l∆∞u</span>
                </div>
                <div>{{savedJob.savedDate}}</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Ung Vien Role - No data fallback -->
        <div *ngIf="isUngVien() && !hasSavedJobs" class="text-center py-4">
          <div class="text-muted">
            <i class="fas fa-info-circle"></i>
            <p>B·∫°n ch∆∞a l∆∞u vi·ªác l√†m n√†o</p>
          </div>
        </div>

        <!-- Ung Vien Role - Vi·ªác l√†m ƒë√£ ·ª©ng tuy·ªÉn m·ªõi nh·∫•t -->
        <div *ngIf="isUngVien() && hasAppliedJobs" class="mt-4 mb-2">
          <div class="d-flex justify-content-between align-items-center mb-4">
            <div class="section-data-title">Vi·ªác l√†m ƒë√£ ·ª©ng tuy·ªÉn m·ªõi nh·∫•t</div>
            <a href="#" class="btn btn-outline-primary btn-sm">Xem t·∫•t c·∫£</a>
          </div>
          <div class="user-data-wrap" *ngFor="let appliedJob of appliedJobsData">
            <div class="user-data-user">
              <img [src]="appliedJob.logo" alt="" class="avatar">
              <a href="#" class="name">{{appliedJob.jobTitle}}</a>
              <div class="experiment tag-wrap green">{{appliedJob.company}}</div>
              <div class="tag">
                <span>{{appliedJob.location}}</span>
                <span class="dot"></span>
                <span>{{appliedJob.salary}}</span>
              </div>
            </div>

            <div class="user-data-info">
              <div class="info-row">
                <div class="d-flex gap-3 align-items-center">
                  <img src="assets/vieclamlaocai/img/icon/icon-pin.svg" alt="">
                  <span>C√¥ng ty</span>
                </div>
                <div>{{appliedJob.company}}</div>
              </div>

              <div class="info-row">
                <div class="d-flex gap-3 align-items-center">
                  <img src="assets/vieclamlaocai/img/icon/icon-pin.svg" alt="">
                  <span>ƒê·ªãa ƒëi·ªÉm</span>
                </div>
                <div>{{appliedJob.location}}</div>
              </div>

              <div class="info-row">
                <div class="d-flex gap-3 align-items-center">
                  <img src="assets/vieclamlaocai/img/icon/icon-pin.svg" alt="">
                  <span>M·ª©c l∆∞∆°ng</span>
                </div>
                <div>{{appliedJob.salary}}</div>
              </div>

              <div class="info-row">
                <div class="d-flex gap-3 align-items-center">
                  <img src="assets/vieclamlaocai/img/icon/icon-pin.svg" alt="">
                  <span>Ng√†y ·ª©ng tuy·ªÉn</span>
                </div>
                <div>{{appliedJob.appliedDate}}</div>
              </div>

              <div class="d-flex justify-content-end mt-3">
                <div class="tag-wrap px-5" [ngClass]="{
                  'status-pending': appliedJob.status === 'pending',
                  'status-reviewing': appliedJob.status === 'reviewing',
                  'status-accepted': appliedJob.status === 'accepted',
                  'status-rejected': appliedJob.status === 'rejected'
                }">{{getStatusText(appliedJob.status)}}</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Ung Vien Role - No applied jobs fallback -->
        <div *ngIf="isUngVien() && !hasAppliedJobs" class="mt-4 ">
          <div class="d-flex justify-content-between align-items-center mb-4">
            <div class="section-data-title">Vi·ªác l√†m ƒë√£ ·ª©ng tuy·ªÉn m·ªõi nh·∫•t</div>
            <a href="#" class="btn btn-outline-primary btn-sm">Xem t·∫•t c·∫£</a>
          </div>
          <div class="text-center py-4">
            <div class="text-muted">
              <i class="fas fa-info-circle"></i>
              <p>B·∫°n ch∆∞a ·ª©ng tuy·ªÉn vi·ªác l√†m n√†o</p>
            </div>
          </div>
        </div>



        <!-- Co Quan Quan Ly Role - Bi·ªÉu ƒë·ªì th·ªëng k√™ ph√™ duy·ªát -->
        <div *ngIf="isCoQuanQuanLy()">
          <div class="chart-container">
            <div class="chart-header">
              <h4 class="chart-title">Th·ªëng k√™ ph√™ duy·ªát doanh nghi·ªáp</h4>
              <div class="chart-legend">
                <span class="legend-item">
                  <span class="legend-color pending"></span>
                  Ch·ªù ph√™ duy·ªát
                </span>
                <span class="legend-item">
                  <span class="legend-color approved"></span>
                  ƒê√£ ph√™ duy·ªát
                </span>
                <span class="legend-item">
                  <span class="legend-color rejected"></span>
                  T·ª´ ch·ªëi
                </span>
              </div>
            </div>
            
            <div class="chart-content">
              <!-- Bi·ªÉu ƒë·ªì c·ªôt cho h√¥m nay -->
              <div class="bar-chart">
                <div class="chart-subtitle">Th·ªëng k√™ h√¥m nay</div>
                <div class="chart-bars">
                  <div class="chart-bar-group">
                    <div class="chart-bar pending" [style.height.%]="getBarHeight(coQuanQuanLyStats.pendingApprovals, coQuanQuanLyStats.totalBusinesses)">
                      <span class="bar-value">{{coQuanQuanLyStats.pendingApprovals}}</span>
                    </div>
                    <div class="bar-label">Ch·ªù duy·ªát</div>
                  </div>
                  
                  <div class="chart-bar-group">
                    <div class="chart-bar approved" [style.height.%]="getBarHeight(coQuanQuanLyStats.approvedBusinesses, coQuanQuanLyStats.totalBusinesses)">
                      <span class="bar-value">{{coQuanQuanLyStats.approvedBusinesses}}</span>
                    </div>
                    <div class="bar-label">ƒê√£ duy·ªát</div>
                  </div>
                  
                  <div class="chart-bar-group">
                    <div class="chart-bar rejected" [style.height.%]="getBarHeight(coQuanQuanLyStats.rejectedBusinesses, coQuanQuanLyStats.totalBusinesses)">
                      <span class="bar-value">{{coQuanQuanLyStats.rejectedBusinesses}}</span>
                    </div>
                    <div class="bar-label">T·ª´ ch·ªëi</div>
                  </div>
                </div>
              </div>
              
              <!-- Th·ªëng k√™ chi ti·∫øt h√¥m nay -->
              <div class="today-stats">
                <div class="today-header">
                  <h5 class="today-title">üìÖ Chi ti·∫øt h√¥m nay</h5>
                  <div class="today-date">{{getCurrentDate()}}</div>
                </div>
                
                <div class="today-metrics">
                  <div class="metric-item pending">
                    <div class="metric-icon">‚è≥</div>
                    <div class="metric-content">
                      <div class="metric-value">{{coQuanQuanLyStats.pendingApprovals}}</div>
                      <div class="metric-label">Ch·ªù ph√™ duy·ªát</div>
                      <div class="metric-change positive">+{{coQuanQuanLyStats.pendingApprovals}} so v·ªõi h√¥m qua</div>
                    </div>
                  </div>
                  
                  <div class="metric-item approved">
                    <div class="metric-icon">‚úÖ</div>
                    <div class="metric-content">
                      <div class="metric-value">{{coQuanQuanLyStats.approvedBusinesses}}</div>
                      <div class="metric-label">ƒê√£ ph√™ duy·ªát</div>
                      <div class="metric-change positive">+{{coQuanQuanLyStats.approvedBusinesses}} so v·ªõi h√¥m qua</div>
                    </div>
                  </div>
                  
                  <div class="metric-item rejected">
                    <div class="metric-icon">‚ùå</div>
                    <div class="metric-content">
                      <div class="metric-value">{{coQuanQuanLyStats.rejectedBusinesses}}</div>
                      <div class="metric-label">T·ª´ ch·ªëi</div>
                      <div class="metric-change negative">+{{coQuanQuanLyStats.rejectedBusinesses}} so v·ªõi h√¥m qua</div>
                    </div>
                  </div>
                  
                  <div class="metric-item total">
                    <div class="metric-icon">üìä</div>
                    <div class="metric-content">
                      <div class="metric-value">{{coQuanQuanLyStats.totalBusinesses}}</div>
                      <div class="metric-label">T·ªïng doanh nghi·ªáp</div>
                      <div class="metric-change neutral">T·ªïng c·ªông trong h·ªá th·ªëng</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Fallback content if no role or no data -->
        <div *ngIf="!isDoanhNghiep() && !isUngVien() && !isCoQuanQuanLy()">
          <div class="text-center py-4">
            <div class="text-muted">
              <i class="fas fa-info-circle"></i>
              <p>Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ xem dashboard</p>
            </div>
          </div>
        </div>

      </div>

    </div>
  </div>
</div>

<!-- Business Verification Modal -->
<app-email-verification 
  [isOpen]="showEmailVerificationModal"
  (closeModalEvent)="closeEmailVerificationModal()"
  (verificationSubmitted)="onVerificationSubmitted($event)">
</app-email-verification>